---
slug: github-commit-crawler
title: Github Commit Crawler
authors: [김지섭]
tags: [github]
---

여러 Github 사용자들에 대한 최근 1년간의 커밋 개수를 크롤링하는 프로그램입니다.

<!--truncate-->

```javascript title="crawl github id"
githubUsernames = [...document.querySelectorAll('.comment-list')].map(d => {
  const t = d.innerText;
  const regex = /https?:\/\/github\.com\/([a-zA-Z0-9_-]+)/g;
  const matches = [];

  let match;
  while ((match = regex.exec(t)) !== null) {
    matches.push(match[1]);
  }
  return matches[0];
});

console.log(JSON.stringify(githubUsernames));
```

```javascript title="crawl commit count"
githubUsernames = []; // paste github usernames

async function getCommitCountHtml(username) {
  try {
    const profileResponse = await fetch(`https://github.com/${username}`);
    const profileHtml = await profileResponse.text();
    const parser = new DOMParser();
    const profileDoc = parser.parseFromString(profileHtml, 'text/html');

    const contributionsElem = profileDoc.querySelector(
      'div.js-yearly-contributions h2',
    );

    if (contributionsElem) {
      const contributionsText = contributionsElem.textContent.trim();
      const contributionsMatch = contributionsText.match(
        /(\d[\d,]*)\s+contributions?/,
      );

      if (contributionsMatch) {
        const totalCommits = parseInt(
          contributionsMatch[1].replace(/,/g, ''),
          10,
        );
        return { username, totalCommits };
      }
    }

    throw new Error('Could not find contributions element');
  } catch (error) {
    console.error('Error:', error.message);
    return { username, totalCommits: -1 };
  }
}

delay = ms => new Promise(resolve => setTimeout(resolve, ms));

async function fetchCommitCounts(usernames) {
  const results = [];

  for (const username of usernames) {
    const result = await getCommitCountHtml(username);
    results.push(result);
    console.log(result);
    await delay(50);
  }

  return results;
}

res = await fetchCommitCounts(githubUsernames);
```

---

이 코드는 GPT-4로 생성되었으며 **김지섭**에 의해 수정되었습니다.
