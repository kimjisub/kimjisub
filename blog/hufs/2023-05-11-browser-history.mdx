---
slug: Browser History Manager
title: Browser History Manager
authors: [김지섭_hufs]
tags: [DataStructure, c/c++]
hide_table_of_contents: true
---

브라우저의 방문기록 뒤로가기, 앞으로가기 기능을 구현하는 문제입니다.

<!--truncate-->

## 구조체 정의

Double Linked List를 구현하기 위한 구조체입니다.
자신의 앞과 뒤의 노드를 가리키는 포인터를 가지고 있습니다.

```c title="typedef" showLineNumbers
struct Node {
    char url[MAX_URL_LENGTH];
    struct Node *prev;
    struct Node *next;
};

typedef struct {
    struct Node *head;
    struct Node *cursor;
} BrowserHistory;
```

## 초기화 함수

Double Linked List를 초기화하면서, 하나의 노드를 추가하는 과정입니다.
새로운 노드를 생성하고, url을 복사한 뒤, `prev`, `next` 포인터를 null로 초기화합니다.
그리고 Double Linked List의 head와 cursor 포인터에 해당 노드의 주소를 저장합니다.

```c title="browserHistoryCreate" showLineNumbers
BrowserHistory *browserHistoryCreate(char *url) {
    // 새로운 노드 생성
    struct Node *newNode = (struct Node *)malloc(sizeof(struct Node));
    strcpy(newNode->url, url);
    newNode->prev = NULL;
    newNode->next = NULL;

    // 방문기록 객체 생성
    BrowserHistory *browserHistory =
        (BrowserHistory *)malloc(sizeof(BrowserHistory));
    browserHistory->head = newNode;
    browserHistory->cursor = newNode;

    return browserHistory;
}
```

## 노드 재귀적 삭제 함수

주어진 노드를 포함하여 이후의 모든 노드를 삭제하는 함수입니다.
주어진 노드가 null이 될 때까지 재귀적으로 호출하며, 노드를 삭제합니다.
재귀호출부를 마지막 라인에 작성함으로써 _tail recursion_ 최적화를 진행하였습니다.

```c title="browserHistoryFreeNode" showLineNumbers
void browserHistoryFreeNode(struct Node *node) {
    if (node == NULL)
        return;
    struct Node *next = node->next;
    free(node);
    browserHistoryFreeNode(node->next);
}
```

## 방문기록 추가 함수

새로운 웹사이트를 방문하였을 때의 구현체입니다.
현재를 기준으로 Forward 방향의 기록을 모두 삭제하고 그 자리에 방문한 기록이 추가되게 됩니다.
아래는 각 과정에 대한 설명입니다.

1. 새로운 노드를 생성합니다
2. 이후 방문기록을 삭제합니다
3. 새로운 노드를 다음 노드로 추가합니다
4. 커서를 새로운 노드로 이동합니다

```c title="browserHistoryVisit" showLineNumbers
void browserHistoryVisit(BrowserHistory *obj, char *url) {
    // 새로운 노드 생성
    struct Node *newNode = (struct Node *)malloc(sizeof(struct Node));
    strcpy(newNode->url, url);

    // 이후 방문기록 삭제
    browserHistoryFreeNode(obj->cursor->next);

    // 새로운 노드를 다음 노드로 추가
    obj->cursor->next = newNode;
    newNode->prev = obj->cursor;
    newNode->next = NULL;

    // 커서를 새로운 노드로 이동
    obj->cursor = obj->cursor->next;
}
```

## 뒤로가기 함수

현재 웹사이트에서 이전 웹사이트로 이동하는 함수입니다.
재귀적으로 steps를 소진하며 이전 웹사이트로 이동합니다.
아래는 각 과정에 대한 설명입니다.

1. steps를 모두 소진한 경우 종료합니다
2. 이전 노드가 없는 경우 종료합니다
3. 위의 예외사항이 아닌 경우 cursor를 이전 노드로 이동합니다
4. 재귀적으로 steps를 소진합니다

```c title="browserHistoryBack" showLineNumbers
char *browserHistoryBack(BrowserHistory *obj, int steps) {
    // steps를 모두 소진한 경우 종료
    if (steps == 0) {
        return obj->cursor->url;
    }
    // 이전 노드가 없는 경우 종료
    if (obj->cursor->prev == NULL) {
        return obj->cursor->url;
    }

    // 위의 예외사항이 아닌 경우 cursor를 이전 노드로 이동
    obj->cursor = obj->cursor->prev;

    // 재귀적으로 steps를 소진
    return browserHistoryBack(obj, steps - 1);
}
```

## 앞으로가기 함수

현재 웹사이트에서 다음 웹사이트로 이동하는 함수입니다.
재귀적으로 steps를 소진하며 다음 웹사이트로 이동합니다.
아래는 각 과정에 대한 설명입니다.

1. steps를 모두 소진한 경우 종료합니다
2. 다음 노드가 없는 경우 종료합니다
3. 위의 예외사항이 아닌 경우 cursor를 다음 노드로 이동합니다
4. 재귀적으로 steps를 소진합니다

```c title="browserHistoryForward" showLineNumbers
char *browserHistoryForward(BrowserHistory *obj, int steps) {
    // steps를 모두 소진한 경우 종료
    if (steps == 0)
        return obj->cursor->url;
    // 다음 노드가 없는 경우 종료
    if (obj->cursor->next == NULL)
        return obj->cursor->url;

    // 위의 예외사항이 아닌 경우 cursor를 다음 노드로 이동
    obj->cursor = obj->cursor->next;

    // 재귀적으로 steps를 소진
    return browserHistoryForward(obj, steps - 1);
}
```

## Destructor

Double Linked List 전체를 해제하는 함수입니다.
모든 방문 기록을 삭제하고, 마지막으로 BrowserHistory 객체를 삭제합니다.

```c title="browserHistoryFree" showLineNumbers
void browserHistoryFree(BrowserHistory *obj) {
    browserHistoryFreeNode(obj->head);
    free(obj);
}
```

## 예시

위의 코드를 예시를 통하여 설명하면 다음과 같습니다.

```text title="example"
BrowserHistory visit visit visit back back forward visit forward back back
hufs.ac.kr google.com naver.com youtube.com 1 1 1 linkedin.com 2 2 7
```

각 액션마다 링크드리스트의 상태를 디버깅하면 다음과 같습니다.

```text title="BrowserHistory hufs.ac.kr"
hufs.ac.kr <- head, cursor
```

```text title="visit google.com"
hufs.ac.kr <- head
google.com <- cursor
```

```text title="visit naver.com"
hufs.ac.kr <- head
google.com
naver.com <- cursor
```

```text title="visit youtube.com"
hufs.ac.kr <- head
google.com
naver.com
youtube.com <- cursor
```

```text title="back 1"
hufs.ac.kr <- head
google.com
naver.com <- cursor
youtube.com
```

```text title="back 1"
hufs.ac.kr <- head
google.com <- cursor
naver.com
youtube.com
```

```text title="forward 1"
hufs.ac.kr <- head
google.com
naver.com <- cursor
youtube.com
```

```text title="visit linkedin.com"
hufs.ac.kr <- head
google.com
naver.com
linkedin.com <- cursor
```

```text title="forward 2"
hufs.ac.kr <- head
google.com
naver.com
linkedin.com <- cursor
```

```text title="back 2"
hufs.ac.kr <- head
google.com <- cursor
naver.com
linkedin.com
```

```text title="back 7"
hufs.ac.kr <- head, cursor
google.com
naver.com
linkedin.com
```

위 코드는 [Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html)에 의해 포매팅되었으며,
GPT 및 여타 AI 모델을 이용하지 않고 작성되었습니다.
