---
slug: linear-js-util
title: Linear Javascript Util
authors: [김지섭]
tags: [linear, javascript]
---

`Linear.app`을 코드로 제어하는 방법

<!--truncate-->

```javascript
class Issue {
  issueDom;
  id;
  code;
  constructor(issueDom) {
    this.issueDom = issueDom;
    const title = issueDom.querySelector(
      'div > div > span[color=labelTitle]',
    ).innerText;
    const id = issueDom.querySelector(
      'div > div > span[color=labelMuted]',
    ).innerText;
    const code = title.slice(0, 7).replaceAll(/[-\[ ]/g, '');
    const selected = issueDom.getAttribute('data-selected') === 'true';
    const selectButton = issueDom.querySelector(
      'div > div > div > div > input',
    );

    this.id = id;
    this.code = code;
  }

  get isSelected() {
    return this.issueDom.getAttribute('data-selected') === 'true';
  }

  setSelected(selected) {
    const selectButton = this.issueDom.querySelector(
      'div > div > div > div > input',
    );
    if (this.isSelected !== selected) selectButton.click();
  }
}

function getProgress(dom) {
  const progress = dom.scrollTop / (dom.scrollHeight - dom.offsetHeight);
  if (isNaN(progress)) return 1;
  return progress;
}

async function selectByList(rawList) {
  const codeList = [...new Set(rawList)];
  const listDom = document.querySelector('main div[tabindex] > div[tabindex]');
  listDom.scroll(0, 0);
  let unfoundCodes = [...codeList];
  const ids = [];
  const issues = {};
  for (;;) {
    await sleep(300);
    const { visibleCodes, visibleIds, visibleIssues } =
      selectByListJustInScreen(codeList);
    unfoundCodes = unfoundCodes.filter(item => !visibleCodes.includes(item));
    ids.push(...visibleIds);
    visibleIssues.forEach(issue => {
      issues[issue.id] = issue;
    });
    const progress = getProgress(listDom);
    if (progress === 1) {
      break;
    }
    listDom.scrollBy(0, listDom.offsetHeight);
  }
  return {
    제공된_Codes_개수: rawList.length,
    제공된_Codes_실제개수: codeList.length,
    제공된_Codes_중복: findDuplicates(rawList),
    현재_리스트_중복된_Codes: findDuplicates(
      Object.values(issues).map(issue => issue.code),
    ),
    검색_결과_발견하지_못한_Codes: unfoundCodes,
  };
}

function selectByListJustInScreen(codeList) {
  const itemDoms = [
    ...document.querySelectorAll(
      'main div[tabindex] > div[tabindex] > div > a',
    ),
  ];
  const visibleIssues = [];
  const visibleCodes = [];
  const visibleIds = [];
  itemDoms.forEach(itemDom => {
    const issue = new Issue(itemDom);
    const include = codeList.includes(issue.code);
    issue.setSelected(include);

    visibleCodes.push(issue.code);
    visibleIds.push(issue.id);
    visibleIssues.push(issue);
  });

  return {
    visibleCodes,
    visibleIds,
    visibleIssues,
  };
}

function sleep(ms) {
  return new Promise(r => setTimeout(r, ms));
}
function findDuplicates(arr) {
  return arr.filter((item, index) => arr.indexOf(item) !== index);
}
```
